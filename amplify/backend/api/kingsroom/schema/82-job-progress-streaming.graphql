# 82-job-progress-streaming.graphql
# ==========================================
# Job Progress Streaming - Type Definitions
# 
# NOTE: The mutation (publishJobProgress) and subscription (onJobProgress)
# have been moved to 99-mutations.graphql to ensure proper resolver creation.
# This file now only contains the type definitions.
#
# USAGE (Lambda side):
#   await client.graphql({
#     query: publishJobProgress,
#     variables: {
#       jobId: 'xxx',
#       event: {
#         jobId: 'xxx',
#         entityId: 'yyy',
#         status: 'RUNNING',
#         // ... other fields
#       }
#     }
#   });
#
# USAGE (Client side):
#   const subscription = client.graphql({
#     query: onJobProgress,
#     variables: { jobId: 'xxx' }
#   }).subscribe({...});
# ==========================================

# =============================================================================
# JOB PROGRESS EVENT TYPE
# =============================================================================

type JobProgressEvent @aws_iam @aws_cognito_user_pools {
  # Identifiers
  jobId: ID!
  entityId: ID!
  
  # Status
  status: String!                   # QUEUED, RUNNING, COMPLETED, FAILED, etc.
  stopReason: String                # Why job stopped (if applicable)
  
  # Progress counters
  totalURLsProcessed: Int!
  newGamesScraped: Int!
  gamesUpdated: Int!
  gamesSkipped: Int!
  errors: Int!
  blanks: Int!
  
  # Current position (for range scans)
  currentId: Int
  startId: Int
  endId: Int
  
  # Timing
  startTime: AWSDateTime
  durationSeconds: Int!
  
  # Rates & metrics
  successRate: Float
  averageScrapingTime: Float
  
  # Cache stats
  s3CacheHits: Int
  
  # Error tracking
  consecutiveNotFound: Int
  consecutiveErrors: Int
  consecutiveBlanks: Int
  lastErrorMessage: String
  
  # Timestamp of this event (auto-populated by resolver)
  publishedAt: AWSDateTime
}

# =============================================================================
# INPUT TYPE
# =============================================================================

input JobProgressEventInput {
  # Identifiers
  jobId: ID!
  entityId: ID!
  
  # Status
  status: String!
  stopReason: String
  
  # Progress counters
  totalURLsProcessed: Int!
  newGamesScraped: Int!
  gamesUpdated: Int!
  gamesSkipped: Int!
  errors: Int!
  blanks: Int!
  
  # Current position
  currentId: Int
  startId: Int
  endId: Int
  
  # Timing
  startTime: AWSDateTime
  durationSeconds: Int!
  
  # Rates & metrics
  successRate: Float
  averageScrapingTime: Float
  
  # Cache stats
  s3CacheHits: Int
  
  # Error tracking
  consecutiveNotFound: Int
  consecutiveErrors: Int
  consecutiveBlanks: Int
  lastErrorMessage: String
}